extends ../layout.pug

block content
  h1= t('layouts.application.tasks')
  if success && success.length
    .alert.alert-success= success[0]
  form(method="get" action="/tasks" class="row g-3 mb-4" id="tasks-filter-form")
    .col-md-3
      label.form-label(for="data_status")= t('tasks.index.status')
      select.form-select(name="status" id="data_status")
        option(value="")= t('tasks.index.all')
        if statuses && statuses.length
          each status in statuses
            option(value=status.id selected=(status.id == query.status))= status.name
    .col-md-3
      label.form-label(for="executor")= t('tasks.index.executor')
      select.form-select(name="executor" id="data_executor")
        option(value="")= t('tasks.index.all')
        if users && users.length
          each user in users
            option(value=user.id selected=(user.id == query.executor))= user.firstName + ' ' + user.lastName
    .col-md-3
      label.form-label(for="data_label")= t('tasks.index.label')
      select.form-select(name="label" id="data_label")
        option(value="")= t('tasks.index.all')
        option(value="__no_label__" selected=(query.label == '__no_label__'))= t('tasks.index.noLabel')
        if labels && labels.length
          each label in labels
            option(
              value=label.id
              selected=(query.label == label.id)
            )= label.name
    .col-md-3.d-flex.align-items-start
      div.d-flex.align-items-center.mt-4.mb-3.w-100
        input.form-check-input(type="checkbox" name="my" id="my" checked=(query.my ? true : false))
        label.form-check-label(for="my" style='margin-left: 8px;')= t('tasks.index.onlyMy')
        button.btn.btn-primary.ms-3(type="submit")= t('tasks.index.show')
  if currentUser
    a.btn.btn-primary(href="/tasks/new")= t('tasks.index.newTask')
  if !currentUser && !tasks.length
    div.alert.alert-info.mt-4= t('tasks.index.signInToAdd')
  else
    table.table.table-bordered.mt-3
      thead
        tr
          th= t('tasks.index.name')
          th= t('tasks.index.statusTh')
          th= t('tasks.index.executor')
          th(style='width: 25px; text-align: left;')= t('tasks.index.actions')
      tbody
        if tasks.length
          each task in tasks
            tr
              td
                a(href=`/tasks/${task.id}` class='fw-bold fs-5 text-decoration-none' style='color: #4a6fa5;')
                  span(style='padding: 2px 8px; border-radius: 6px; background: #e3f2fd; border: 1px solid #90caf9; color: #4a6fa5;')= task.name
              td
                if task.status
                  span(style='padding: 2px 8px; border-radius: 6px; background: #e3f2fd; border: 1px solid #90caf9; font-weight: 500; color: #4a6fa5;')= task.status.name
                else
                  span.text-muted= t('tasks.index.noStatus')
              td= task.executor ? `${task.executor.firstName} ${task.executor.lastName}` : '-'
              td(style='text-align: left; vertical-align: middle;')
                if currentUser && (currentUser.id === task.creatorId || currentUser.id === task.creator_id)
                  a.btn.btn-sm(href=`/tasks/${task.id}/edit` style='background: #e3f2fd; color: #1976d2; border: 1px solid #90caf9; margin-right: 4px;')= t('tasks.index.edit')
                  form(method='post', action=`/tasks/${task.id}/delete?lang=${typeof currentLang !== 'undefined' ? currentLang : 'en'}`, style='display:inline')
                    button.btn.btn-sm(type='submit' style='background: #e3f2fd; color: #1976d2; border: 1px solid #90caf9;')= t('tasks.index.delete')
        else
          tr
            td(colspan='6')= t('tasks.index.noTasksFound')
  if query.my && (query.my === 'on' || query.my === 'true' || query.my === true || query.my === 1 || query.my === '1')
    div.alert.alert-info.mt-3(style='font-weight: 500; color: #1976d2;')
      | #{t('tasks.index.onlyMyActive')}
  p.mt-2.text-muted Tasks count: #{tasks.length}