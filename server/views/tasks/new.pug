extends ../layout.pug

block content
  // ...existing code...

  h1= t('tasks.index.newTask')

  if error && error.length
    .alert.alert-danger= t('flash.tasks.create.error')

  if success && success.length
    each msg in success
      .alert.alert-success(style='background: #e3f2fd; color: #1976d2; border: 1px solid #90caf9;')= msg

  form(method='post', action='/tasks')
    .form-group
      label(for='name')= t('tasks.index.name')
      input#name.form-control(class=errors && errors.name ? 'is-invalid' : '', type='text', name='name', value=task.name || '')
      if errors && errors.name
        .invalid-feedback.d-block= errors.name
    .form-group
      label(for='description')= t('tasks.index.description')
      textarea#description.form-control(name='description')= task.description || ''
    .form-group
      label(for='data_statusId')= t('tasks.index.status')
      select#data_statusId.form-control(class=errors && errors.status_id ? 'is-invalid' : '', name='status_id')
        option(value='')= t('tasks.index.statusPlaceholder')
        each status in statuses
          option(value=status.id selected=(task.status_id==status.id))= status.name
      if errors && errors.status_id
        .invalid-feedback.d-block= errors.status_id
    .form-group
      label(for='data_executorId')= t('tasks.index.executor')
      select#data_executorId.form-control(name='executorId')
        option(value='')= t('tasks.index.notAssigned' || 'Not assigned')
        each user in users
          option(value=user.id selected=(task.executorId==user.id))= user.firstName + ' ' + user.lastName
    .form-group
      label(for='data_labels')= t('tasks.index.labels')
      select#data_labels.form-control(name='labels[]', multiple)
        if labels && labels.length
          each label in labels
            option(value=label.id selected=(task.labels && task.labels.includes(label.id)))= label.name
        else
          span(style='color: #bbb;') Нет меток
    .mt-4
      button.btn.btn-primary(type='submit') Создать
      a.btn.btn-secondary.ms-2(href='/tasks') Отмена