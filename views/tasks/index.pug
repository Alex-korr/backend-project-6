extends ../layout.pug

block content
  h1= t('layouts.application.tasks')
  form(method="get" action="/tasks" class="row g-3 mb-4")
    .col-md-3
      label.form-label(for="status")= t('tasks.index.status')
      select.form-select(name="status" id="status")
        option(value="")= t('tasks.index.all')
        if statuses && statuses.length
          each status in statuses
            option(value=status.id selected=(status.id == query.status))= status.name
    .col-md-3
      label.form-label(for="executor")= t('tasks.index.executor')
      select.form-select(name="executor" id="executor")
        option(value="")= t('tasks.index.all')
        if users && users.length
          each user in users
            option(value=user.id selected=(user.id == query.executor))= user.name
    .col-md-3
      label.form-label(for="label")= t('tasks.index.label')
      select.form-select(name="label" id="label")
        option(value="")= t('tasks.index.all')
        if labels && labels.length
          each label in labels
            option(value=label.id selected=(label.id == query.label))= label.name
    .col-md-3.d-flex.align-items-end
      div.form-check
        input.form-check-input(type="checkbox" name="my" id="my" checked=(query.my ? true : false))
        label.form-check-label(for="my")= t('tasks.index.onlyMy')
      button.btn.btn-primary.ms-3(type="submit")= t('tasks.index.filter')
  if error.length
    each msg in error
      .alert.alert-danger= msg
  if success.length
    each msg in success
      .alert.alert-success= msg
  if currentUser
    a.btn.btn-primary(href=`/tasks/new?lang=${typeof currentLang !== 'undefined' ? currentLang : 'en'}`)= t('tasks.index.newTask')
  if !currentUser && !tasks.length
    div.alert.alert-info.mt-4= t('tasks.index.signInToAdd')
  else
    table.table.table-bordered.mt-3
      thead
        tr
          th= t('tasks.index.name')
          th= t('tasks.index.statusTh')
          th= t('tasks.index.creator')
          th= t('tasks.index.executor')
          th= t('tasks.index.actions')
      tbody
        if tasks.length
          each task in tasks
            tr
              td
                a(href=`/tasks/${task.id}?lang=${typeof currentLang !== 'undefined' ? currentLang : 'en'}`)= task.name
                if task.labels && task.labels.length
                  ul.list-inline.mt-2
                    each label in task.labels
                      li.list-inline-item.badge.bg-info.text-dark= label.name
              td= task.status ? task.status.name : ''
              td= task.creator ? task.creator.name : ''
              td= task.executor ? task.executor.name : ''
              td
                if currentUser
                  a.btn.btn-sm.btn-secondary(href=`/tasks/${task.id}/edit?lang=${typeof currentLang !== 'undefined' ? currentLang : 'en'}`)= t('layouts.application.edit')
                  if currentUser.id === task.creatorId
                    form(method='post', action=`/tasks/${task.id}?_method=delete&lang=${typeof currentLang !== 'undefined' ? currentLang : 'en'}`, style='display:inline')
                      button.btn.btn-sm.btn-danger(type='submit')= t('layouts.application.delete')
        else
          tr
            td(colspan='5')= t('tasks.index.noTasksFound')
