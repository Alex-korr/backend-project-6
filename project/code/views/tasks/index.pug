extends ../layout.pug

block content
  h1= t('layouts.application.tasks')
  // ...existing code...
  form(method="get" action="/tasks" class="row g-3 mb-4")
    .col-md-3
      label.form-label(for="status")= t('tasks.index.status')
      select.form-select(name="status" id="status")
        option(value="")= t('tasks.index.all')
        if statuses && statuses.length
          each status in statuses
            option(value=status.id selected=(status.id == query.status))= status.name
    .col-md-3
      label.form-label(for="executor")= t('tasks.index.executor')
      select.form-select(name="executor" id="executor")
        option(value="")= t('tasks.index.all')
        if users && users.length
          each user in users
            option(value=user.id selected=(user.id == query.executor))= user.firstName + ' ' + user.lastName
    .col-md-3
      label.form-label= t('tasks.index.label')
      .checkbox-group(style='height: 75px; overflow-y: scroll; background: #f8f8f8; border: 1px solid #ccc; border-radius: 8px; padding: 12px;')
        if labels && labels.length
          each label in labels
            label.form-check(style='display: flex; align-items: center; margin-bottom: 8px;')
              input.form-check-input(type='checkbox', name='label', value=label.id checked=(Array.isArray(query.label) ? query.label.includes(label.id.toString()) : query.label == label.id))
              span.form-check-label(style='margin-left: 8px;')= label.name
        else
          span(style='color: #bbb;')= t('labels.index.noLabels')
    .col-md-3.d-flex.align-items-start
      div.d-flex.align-items-center.mt-4.mb-3.w-100
        input.form-check-input(type="checkbox" name="my" id="my" checked=(query.my ? true : false))
        label.form-check-label(for="my" style='margin-left: 8px;')= t('tasks.index.onlyMy')
        button.btn.btn-primary.ms-3(type="submit")= t('tasks.index.filter')
  // ...existing code...
  if currentUser
    a.btn.btn-primary(href=`/tasks/new?lang=${typeof currentLang !== 'undefined' ? currentLang : 'en'}`)= t('tasks.index.newTask')
  if !currentUser && !tasks.length
    div.alert.alert-info.mt-4= t('tasks.index.signInToAdd')
  else
    table.table.table-bordered.mt-3
      thead
        tr
          th= t('tasks.index.name')
          th= t('tasks.index.statusTh')
          th= t('tasks.index.description')
          th= t('tasks.index.executor')
          th= t('tasks.index.labels')
          th(style='width: 25px; text-align: left;')= t('tasks.index.actions')
      tbody
        if tasks.length
          each task in tasks
            tr
              td
                a(href=`/tasks/${task.id}?lang=${typeof currentLang !== 'undefined' ? currentLang : 'en'}` class='fw-bold fs-5 text-decoration-none' style='color: #4a6fa5;')
                  span(style='padding: 2px 8px; border-radius: 6px; background: #e3f2fd; border: 1px solid #90caf9; color: #4a6fa5;')= task.name
              td
                if task.status
                  span(style='padding: 2px 8px; border-radius: 6px; background: #e3f2fd; border: 1px solid #90caf9; font-weight: 500; color: #4a6fa5;')= task.status.name
                else
                  span.text-muted Нет статуса
              td= task.description || '-'
              td= task.executor ? task.executor.firstName + ' ' + task.executor.lastName : '-'
              td
                if task.labels && task.labels.length
                  each label in task.labels
                    span.badge.bg-info.text-dark.me-1= label.name
                else
                  span.text-muted= t('labels.index.noLabels')
              td(style='text-align: left; vertical-align: middle;')
                if currentUser && currentUser.id === task.creatorId
                    form(method='post', action=`/tasks/${task.id}/delete?lang=${typeof currentLang !== 'undefined' ? currentLang : 'en'}`, style='display:inline')
                      button.btn.btn-sm(type='submit' style='background: #e3f2fd; color: #1976d2; border: 1px solid #90caf9;')= t('tasks.index.delete')
        else
          tr
            td(colspan='6')= t('tasks.index.noTasksFound')
